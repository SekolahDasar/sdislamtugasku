<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistem Pendataan Siswa SD</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gradient-to-br from-yellow-50 to-orange-100 font-sans"><!-- Login Screen -->
  <div id="loginScreen" class="min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
   <div class="max-w-md w-full space-y-8 bg-white p-8 rounded-xl shadow-lg">
    <div class="text-center">
     <div class="mx-auto h-16 w-16 bg-orange-500 rounded-full flex items-center justify-center mb-4">
      <svg class="h-8 w-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
      </svg>
     </div>
     <h2 id="loginTitle" class="text-3xl font-bold text-gray-900 mb-2">Login Administrator</h2>
     <p class="text-gray-600">Masuk untuk mengakses sistem pendataan siswa</p>
    </div>
    <form id="loginForm" class="mt-8 space-y-6">
     <div><label for="username" class="block text-sm font-medium text-gray-700 mb-2">Username</label> <input id="username" name="username" type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-orange-500 focus:border-orange-500" placeholder="Masukkan username">
     </div>
     <div><label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label> <input id="password" name="password" type="password" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-orange-500 focus:border-orange-500" placeholder="Masukkan password">
     </div>
     <div id="loginError" class="hidden text-red-600 text-sm text-center bg-red-50 p-2 rounded-md"></div><button type="submit" id="loginBtn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-500 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-colors"> Masuk </button>
    </form>
    <div class="text-center text-sm text-gray-500 mt-4">
     <p>Demo: username: <strong>admin</strong>, password: <strong>admin123</strong></p>
    </div>
   </div>
  </div><!-- Main Dashboard -->
  <div id="dashboard" class="hidden min-h-full"><!-- Header -->
   <header class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
     <div class="flex justify-between items-center py-4">
      <div class="flex items-center">
       <div class="h-10 w-10 bg-orange-500 rounded-lg flex items-center justify-center mr-3">
        <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
        </svg>
       </div>
       <div>
        <h1 id="appTitle" class="text-xl font-semibold text-gray-900">Sistem Pendataan Siswa</h1>
        <p id="schoolName" class="text-sm text-gray-500">SD Islam Tugasku</p>
       </div>
      </div>
      <div class="flex items-center space-x-4"><span class="text-sm text-gray-600">Selamat datang, Admin</span> <button id="logoutBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors"> Keluar </button>
      </div>
     </div>
    </div>
   </header><!-- Navigation Menu -->
   <nav class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
     <div class="flex space-x-8"><button id="menuBeranda" class="nav-item active border-b-2 border-orange-500 text-orange-600 py-4 px-1 text-sm font-medium transition-colors">
       <svg class="h-5 w-5 inline mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
       </svg> Beranda </button> <button id="menuSiswaAktif" class="nav-item border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-4 px-1 text-sm font-medium transition-colors">
       <svg class="h-5 w-5 inline mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
       </svg> Data Siswa Aktif </button> <button id="menuSiswaKeluar" class="nav-item border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-4 px-1 text-sm font-medium transition-colors">
       <svg class="h-5 w-5 inline mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
       </svg> Data Siswa Keluar/Mutasi </button> <button id="menuGuru" class="nav-item border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-4 px-1 text-sm font-medium transition-colors">
       <svg class="h-5 w-5 inline mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
       </svg> Data Guru </button> <button id="menuTendik" class="nav-item border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-4 px-1 text-sm font-medium transition-colors">
       <svg class="h-5 w-5 inline mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
       </svg> Staff Sekolah </button> <button id="menuAkun" class="nav-item border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-4 px-1 text-sm font-medium transition-colors">
       <svg class="h-5 w-5 inline mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
       </svg> Pengaturan Akun </button>
     </div>
    </div>
   </nav><!-- Main Content -->
   <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8"><!-- Beranda Content -->
    <div id="berandaContent" class="content-section"><!-- Stats Cards -->
     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="bg-white overflow-hidden shadow rounded-lg">
       <div class="p-5">
        <div class="flex items-center">
         <div class="flex-shrink-0">
          <div class="h-8 w-8 bg-blue-500 rounded-md flex items-center justify-center">
           <svg class="h-5 w-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
           </svg>
          </div>
         </div>
         <div class="ml-5 w-0 flex-1">
          <dl>
           <dt class="text-sm font-medium text-gray-500 truncate">
            Jumlah Siswa
           </dt>
           <dd id="totalStudents" class="text-lg font-medium text-gray-900">
            0
           </dd>
          </dl>
         </div>
        </div>
       </div>
      </div>
      <div class="bg-white overflow-hidden shadow rounded-lg">
       <div class="p-5">
        <div class="flex items-center">
         <div class="flex-shrink-0">
          <div class="h-8 w-8 bg-green-500 rounded-md flex items-center justify-center">
           <svg class="h-5 w-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
           </svg>
          </div>
         </div>
         <div class="ml-5 w-0 flex-1">
          <dl>
           <dt class="text-sm font-medium text-gray-500 truncate">
            Jumlah Guru
           </dt>
           <dd id="totalTeachers" class="text-lg font-medium text-gray-900">
            0
           </dd>
          </dl>
         </div>
        </div>
       </div>
      </div>
      <div class="bg-white overflow-hidden shadow rounded-lg">
       <div class="p-5">
        <div class="flex items-center">
         <div class="flex-shrink-0">
          <div class="h-8 w-8 bg-purple-500 rounded-md flex items-center justify-center">
           <svg class="h-5 w-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 012 2v6a2 2 0 01-2 2H8a2 2 0 01-2-2V8a2 2 0 012-2V6"></path>
           </svg>
          </div>
         </div>
         <div class="ml-5 w-0 flex-1">
          <dl>
           <dt class="text-sm font-medium text-gray-500 truncate">
            Jumlah Tendik
           </dt>
           <dd id="totalStaff" class="text-lg font-medium text-gray-900">
            0
           </dd>
          </dl>
         </div>
        </div>
       </div>
      </div>
      <div class="bg-white overflow-hidden shadow rounded-lg">
       <div class="p-5">
        <div class="flex items-center">
         <div class="flex-shrink-0">
          <div class="h-8 w-8 bg-orange-500 rounded-md flex items-center justify-center">
           <svg class="h-5 w-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 0h6m-6 0l-2 9a1 1 0 001 1h8a1 1 0 001-1l-2-9m-6 0V7"></path>
           </svg>
          </div>
         </div>
         <div class="ml-5 w-0 flex-1">
          <dl>
           <dt class="text-sm font-medium text-gray-500 truncate">
            Tahun Pelajaran
           </dt>
           <dd id="academicYear" class="text-lg font-medium text-gray-900">
            2024/2025
           </dd>
          </dl>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Quick Actions -->
     <div class="bg-white shadow overflow-hidden sm:rounded-lg">
      <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
       <h3 class="text-lg leading-6 font-medium text-gray-900">Aksi Cepat</h3>
       <p class="mt-1 max-w-2xl text-sm text-gray-500">Kelola data sekolah dengan mudah</p>
      </div>
      <div class="p-6">
       <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"><button onclick="switchMenu('siswaAktif')" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-4 rounded-lg font-medium flex flex-col items-center justify-center transition-colors">
         <svg class="h-8 w-8 mb-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
         </svg> Kelola Siswa Aktif </button> <button onclick="switchMenu('siswaKeluar')" class="bg-red-500 hover:bg-red-600 text-white px-6 py-4 rounded-lg font-medium flex flex-col items-center justify-center transition-colors">
         <svg class="h-8 w-8 mb-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
         </svg> Kelola Siswa Keluar </button> <button onclick="switchMenu('guru')" class="bg-green-500 hover:bg-green-600 text-white px-6 py-4 rounded-lg font-medium flex flex-col items-center justify-center transition-colors">
         <svg class="h-8 w-8 mb-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
         </svg> Kelola Data Guru </button> <button onclick="switchMenu('tendik')" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-4 rounded-lg font-medium flex flex-col items-center justify-center transition-colors">
         <svg class="h-8 w-8 mb-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 012 2v6a2 2 0 01-2 2H8a2 2 0 01-2-2V8a2 2 0 012-2V6"></path>
         </svg> Kelola Staff Sekolah </button>
       </div>
      </div>
     </div>
    </div><!-- Data Siswa Aktif Content -->
    <div id="siswaAktifContent" class="content-section hidden">
     <div class="mb-6">
      <h2 class="text-2xl font-bold text-gray-900 mb-2">Data Siswa Aktif</h2>
      <p class="text-gray-600">Daftar siswa yang masih aktif bersekolah</p>
     </div>
     <div class="flex flex-col sm:flex-row gap-4 mb-6"><button id="addActiveStudentBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium flex items-center justify-center transition-colors">
       <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
       </svg> Tambah Siswa Aktif </button>
      <div class="flex-1 max-w-md"><input id="searchActiveInput" type="text" placeholder="Cari siswa aktif..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
      </div>
     </div>
     <div class="bg-white shadow overflow-hidden sm:rounded-lg">
      <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
       <h3 class="text-lg leading-6 font-medium text-gray-900">Siswa Aktif</h3>
       <p class="mt-1 max-w-2xl text-sm text-gray-500">Siswa yang sedang menempuh pendidikan</p>
      </div>
      <div class="overflow-x-auto">
       <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Siswa</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NIS</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kelas</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
         </tr>
        </thead>
        <tbody id="activeStudentsTableBody" class="bg-white divide-y divide-gray-200">
         <tr id="emptyActiveState">
          <td colspan="5" class="px-6 py-12 text-center text-gray-500">
           <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
           </svg><p class="text-lg font-medium">Belum ada data siswa aktif</p><p class="text-sm">Tambahkan siswa aktif untuk memulai</p></td>
         </tr>
        </tbody>
       </table>
      </div>
     </div>
    </div><!-- Data Siswa Keluar Content -->
    <div id="siswaKeluarContent" class="content-section hidden">
     <div class="mb-6">
      <h2 class="text-2xl font-bold text-gray-900 mb-2">Data Siswa Keluar/Mutasi</h2>
      <p class="text-gray-600">Daftar siswa yang keluar atau mutasi dari SD Islam Tugasku</p>
     </div>
     <div class="flex flex-col sm:flex-row gap-4 mb-6"><button id="addExitStudentBtn" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-medium flex items-center justify-center transition-colors">
       <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
       </svg> Tambah Data Siswa Keluar </button>
      <div class="flex-1 max-w-md"><input id="searchExitInput" type="text" placeholder="Cari siswa keluar..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
      </div>
     </div>
     <div class="bg-white shadow overflow-hidden sm:rounded-lg">
      <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
       <h3 class="text-lg leading-6 font-medium text-gray-900">Siswa Keluar</h3>
       <p class="mt-1 max-w-2xl text-sm text-gray-500">Alumni dan siswa yang keluar</p>
      </div>
      <div class="overflow-x-auto">
       <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Siswa</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NIS</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Alasan Keluar</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal Keluar</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
         </tr>
        </thead>
        <tbody id="exitStudentsTableBody" class="bg-white divide-y divide-gray-200">
         <tr id="emptyExitState">
          <td colspan="5" class="px-6 py-12 text-center text-gray-500">
           <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
           </svg><p class="text-lg font-medium">Belum ada data siswa keluar</p><p class="text-sm">Data siswa yang lulus atau keluar akan muncul di sini</p></td>
         </tr>
        </tbody>
       </table>
      </div>
     </div>
    </div><!-- Data Guru Content -->
    <div id="guruContent" class="content-section hidden">
     <div class="mb-6">
      <h2 class="text-2xl font-bold text-gray-900 mb-2">Data Guru</h2>
      <p class="text-gray-600">Daftar guru dan tenaga pengajar</p>
     </div>
     <div class="flex flex-col sm:flex-row gap-4 mb-6"><button id="addTeacherBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium flex items-center justify-center transition-colors">
       <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
       </svg> Tambah Data Guru </button>
      <div class="flex-1 max-w-md"><input id="searchTeacherInput" type="text" placeholder="Cari guru..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>
     </div>
     <div class="bg-white shadow overflow-hidden sm:rounded-lg">
      <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
       <h3 class="text-lg leading-6 font-medium text-gray-900">Daftar Guru</h3>
       <p class="mt-1 max-w-2xl text-sm text-gray-500">Tenaga pengajar dan pendidik</p>
      </div>
      <div class="overflow-x-auto">
       <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Guru</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NIP</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mata Pelajaran</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
         </tr>
        </thead>
        <tbody id="teachersTableBody" class="bg-white divide-y divide-gray-200">
         <tr id="emptyTeacherState">
          <td colspan="5" class="px-6 py-12 text-center text-gray-500">
           <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
           </svg><p class="text-lg font-medium">Belum ada data guru</p><p class="text-sm">Tambahkan data guru untuk memulai</p></td>
         </tr>
        </tbody>
       </table>
      </div>
     </div>
    </div><!-- Data Tendik Content -->
    <div id="tendikContent" class="content-section hidden">
     <div class="mb-6">
      <h2 class="text-2xl font-bold text-gray-900 mb-2">Data Staff Sekolah</h2>
      <p class="text-gray-600">Daftar staff dan tenaga kependidikan SD</p>
     </div>
     <div class="flex flex-col sm:flex-row gap-4 mb-6"><button id="addStaffBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium flex items-center justify-center transition-colors">
       <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
       </svg> Tambah Data Staff </button>
      <div class="flex-1 max-w-md"><input id="searchStaffInput" type="text" placeholder="Cari tenaga kependidikan..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
      </div>
     </div>
     <div class="bg-white shadow overflow-hidden sm:rounded-lg">
      <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
       <h3 class="text-lg leading-6 font-medium text-gray-900">Daftar Tenaga Kependidikan</h3>
       <p class="mt-1 max-w-2xl text-sm text-gray-500">Staff dan tenaga kependidikan sekolah</p>
      </div>
      <div class="overflow-x-auto">
       <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NIP</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jabatan</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unit Kerja</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
         </tr>
        </thead>
        <tbody id="staffTableBody" class="bg-white divide-y divide-gray-200">
         <tr id="emptyStaffState">
          <td colspan="5" class="px-6 py-12 text-center text-gray-500">
           <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 012 2v6a2 2 0 01-2 2H8a2 2 0 01-2-2V8a2 2 0 012-2V6"></path>
           </svg><p class="text-lg font-medium">Belum ada data tenaga kependidikan</p><p class="text-sm">Tambahkan data tendik untuk memulai</p></td>
         </tr>
        </tbody>
       </table>
      </div>
     </div>
    </div><!-- Pengaturan Akun Content -->
    <div id="akunContent" class="content-section hidden">
     <div class="mb-6">
      <h2 class="text-2xl font-bold text-gray-900 mb-2">Pengaturan Akun</h2>
      <p class="text-gray-600">Kelola akun pengguna sistem pendataan siswa</p>
     </div>
     <div class="flex flex-col sm:flex-row gap-4 mb-6"><button id="addAccountBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-medium flex items-center justify-center transition-colors">
       <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
       </svg> Tambah Akun Baru </button>
      <div class="flex-1 max-w-md"><input id="searchAccountInput" type="text" placeholder="Cari akun berdasarkan username atau nama..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
      </div>
     </div>
     <div class="bg-white shadow overflow-hidden sm:rounded-lg">
      <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
       <h3 class="text-lg leading-6 font-medium text-gray-900">Daftar Akun Pengguna</h3>
       <p class="mt-1 max-w-2xl text-sm text-gray-500">Akun yang dapat mengakses sistem</p>
      </div>
      <div class="overflow-x-auto">
       <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pengguna</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Terakhir Login</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
         </tr>
        </thead>
        <tbody id="accountsTableBody" class="bg-white divide-y divide-gray-200">
         <tr id="emptyAccountState">
          <td colspan="6" class="px-6 py-12 text-center text-gray-500">
           <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
           </svg><p class="text-lg font-medium">Belum ada akun pengguna</p><p class="text-sm">Tambahkan akun untuk memulai</p></td>
         </tr>
        </tbody>
       </table>
      </div>
     </div>
    </div>
   </main>
  </div><!-- Add/Edit Student Modal -->
  <div id="studentModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
   <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
    <div class="mt-3">
     <div class="flex items-center justify-between mb-4">
      <h3 id="modalTitle" class="text-lg font-medium text-gray-900">Tambah Siswa Baru</h3><button id="closeModal" class="text-gray-400 hover:text-gray-600">
       <svg class="h-6 w-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
       </svg></button>
     </div>
     <form id="studentForm" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label for="studentNama" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label> <input type="text" id="studentNama" name="nama" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
       </div>
       <div><label for="studentNis" class="block text-sm font-medium text-gray-700 mb-1">NIS</label> <input type="text" id="studentNis" name="nis" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
       </div>
       <div><label for="studentKelas" class="block text-sm font-medium text-gray-700 mb-1">Kelas</label> <select id="studentKelas" name="kelas" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-orange-500 focus:border-orange-500"> <option value="">Pilih Kelas</option> <option value="1">Kelas 1</option> <option value="2">Kelas 2</option> <option value="3">Kelas 3</option> <option value="4">Kelas 4</option> <option value="5">Kelas 5</option> <option value="6">Kelas 6</option> </select>
       </div>
       <div><label for="studentAgama" class="block text-sm font-medium text-gray-700 mb-1">Agama</label> <select id="studentAgama" name="agama" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-orange-500 focus:border-orange-500"> <option value="">Pilih Agama</option> <option value="Islam">Islam</option> <option value="Kristen">Kristen</option> <option value="Katolik">Katolik</option> <option value="Hindu">Hindu</option> <option value="Buddha">Buddha</option> <option value="Konghucu">Konghucu</option> </select>
       </div>
       <div><label for="studentTanggalLahir" class="block text-sm font-medium text-gray-700 mb-1">Tanggal Lahir</label> <input type="date" id="studentTanggalLahir" name="tanggal_lahir" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
       </div>
       <div><label for="studentJenisKelamin" class="block text-sm font-medium text-gray-700 mb-1">Jenis Kelamin</label> <select id="studentJenisKelamin" name="jenis_kelamin" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"> <option value="">Pilih Jenis Kelamin</option> <option value="Laki-laki">Laki-laki</option> <option value="Perempuan">Perempuan</option> </select>
       </div>
       <div><label for="studentTelepon" class="block text-sm font-medium text-gray-700 mb-1">No. Telepon</label> <input type="tel" id="studentTelepon" name="telepon" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
       </div>
       <div><label for="studentEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label> <input type="email" id="studentEmail" name="email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
       </div>
      </div>
      <div><label for="studentAlamat" class="block text-sm font-medium text-gray-700 mb-1">Alamat</label> <textarea id="studentAlamat" name="alamat" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></textarea>
      </div>
      <div id="formError" class="hidden text-red-600 text-sm bg-red-50 p-2 rounded-md"></div>
      <div class="flex justify-end space-x-3 pt-4"><button type="button" id="cancelBtn" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors"> Batal </button> <button type="submit" id="saveBtn" class="px-4 py-2 bg-indigo-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-indigo-700 transition-colors"> Simpan </button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Add/Edit Teacher Modal -->
  <div id="teacherModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
   <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
    <div class="mt-3">
     <div class="flex items-center justify-between mb-4">
      <h3 id="teacherModalTitle" class="text-lg font-medium text-gray-900">Tambah Data Guru</h3><button id="closeTeacherModal" class="text-gray-400 hover:text-gray-600">
       <svg class="h-6 w-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
       </svg></button>
     </div>
     <form id="teacherForm" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label for="teacherNama" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label> <input type="text" id="teacherNama" name="nama" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500">
       </div>
       <div><label for="teacherNip" class="block text-sm font-medium text-gray-700 mb-1">NIP</label> <input type="text" id="teacherNip" name="nip" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500">
       </div>
       <div><label for="teacherMataPelajaran" class="block text-sm font-medium text-gray-700 mb-1">Mata Pelajaran</label> <select id="teacherMataPelajaran" name="mata_pelajaran" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500"> <option value="">Pilih Mata Pelajaran</option> <option value="Bahasa Indonesia">Bahasa Indonesia</option> <option value="Matematika">Matematika</option> <option value="IPA">IPA</option> <option value="IPS">IPS</option> <option value="Bahasa Inggris">Bahasa Inggris</option> <option value="Pendidikan Agama Islam">Pendidikan Agama Islam</option> <option value="PJOK">PJOK</option> <option value="Seni Budaya">Seni Budaya</option> <option value="Wali Kelas">Wali Kelas</option> </select>
       </div>
       <div><label for="teacherStatus" class="block text-sm font-medium text-gray-700 mb-1">Status</label> <select id="teacherStatus" name="status" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500"> <option value="">Pilih Status</option> <option value="PNS">PNS</option> <option value="Honorer">Honorer</option> <option value="Kontrak">Kontrak</option> </select>
       </div>
       <div><label for="teacherTelepon" class="block text-sm font-medium text-gray-700 mb-1">No. Telepon</label> <input type="tel" id="teacherTelepon" name="telepon" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500">
       </div>
       <div><label for="teacherEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label> <input type="email" id="teacherEmail" name="email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500">
       </div>
      </div>
      <div><label for="teacherAlamat" class="block text-sm font-medium text-gray-700 mb-1">Alamat</label> <textarea id="teacherAlamat" name="alamat" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500"></textarea>
      </div>
      <div id="teacherFormError" class="hidden text-red-600 text-sm bg-red-50 p-2 rounded-md"></div>
      <div class="flex justify-end space-x-3 pt-4"><button type="button" id="cancelTeacherBtn" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors"> Batal </button> <button type="submit" id="saveTeacherBtn" class="px-4 py-2 bg-green-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-green-700 transition-colors"> Simpan </button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Add/Edit Staff Modal -->
  <div id="staffModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
   <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
    <div class="mt-3">
     <div class="flex items-center justify-between mb-4">
      <h3 id="staffModalTitle" class="text-lg font-medium text-gray-900">Tambah Data Staff</h3><button id="closeStaffModal" class="text-gray-400 hover:text-gray-600">
       <svg class="h-6 w-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
       </svg></button>
     </div>
     <form id="staffForm" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label for="staffNama" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label> <input type="text" id="staffNama" name="nama" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-purple-500 focus:border-purple-500">
       </div>
       <div><label for="staffNip" class="block text-sm font-medium text-gray-700 mb-1">NIP</label> <input type="text" id="staffNip" name="nip" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-purple-500 focus:border-purple-500">
       </div>
       <div><label for="staffJabatan" class="block text-sm font-medium text-gray-700 mb-1">Jabatan</label> <select id="staffJabatan" name="jabatan" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-purple-500 focus:border-purple-500"> <option value="">Pilih Jabatan</option> <option value="Tata Usaha">Tata Usaha</option> <option value="Perpustakaan">Perpustakaan</option> <option value="Kebersihan">Kebersihan</option> <option value="Keamanan">Keamanan</option> <option value="Teknisi">Teknisi</option> <option value="Operator">Operator</option> </select>
       </div>
       <div><label for="staffUnitKerja" class="block text-sm font-medium text-gray-700 mb-1">Unit Kerja</label> <input type="text" id="staffUnitKerja" name="unit_kerja" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-purple-500 focus:border-purple-500">
       </div>
       <div><label for="staffTelepon" class="block text-sm font-medium text-gray-700 mb-1">No. Telepon</label> <input type="tel" id="staffTelepon" name="telepon" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-purple-500 focus:border-purple-500">
       </div>
       <div><label for="staffEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label> <input type="email" id="staffEmail" name="email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-purple-500 focus:border-purple-500">
       </div>
      </div>
      <div><label for="staffAlamat" class="block text-sm font-medium text-gray-700 mb-1">Alamat</label> <textarea id="staffAlamat" name="alamat" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-purple-500 focus:border-purple-500"></textarea>
      </div>
      <div id="staffFormError" class="hidden text-red-600 text-sm bg-red-50 p-2 rounded-md"></div>
      <div class="flex justify-end space-x-3 pt-4"><button type="button" id="cancelStaffBtn" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors"> Batal </button> <button type="submit" id="saveStaffBtn" class="px-4 py-2 bg-purple-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-purple-700 transition-colors"> Simpan </button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Add/Edit Account Modal -->
  <div id="accountModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
   <div class="relative top-20 mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white">
    <div class="mt-3">
     <div class="flex items-center justify-between mb-4">
      <h3 id="accountModalTitle" class="text-lg font-medium text-gray-900">Tambah Akun Baru</h3><button id="closeAccountModal" class="text-gray-400 hover:text-gray-600">
       <svg class="h-6 w-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
       </svg></button>
     </div>
     <form id="accountForm" class="space-y-4">
      <div><label for="accountNama" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label> <input type="text" id="accountNama" name="nama" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
      </div>
      <div><label for="accountUsername" class="block text-sm font-medium text-gray-700 mb-1">Username</label> <input type="text" id="accountUsername" name="username" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
      </div>
      <div id="passwordSection"><label for="accountPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label> <input type="password" id="accountPassword" name="password" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
      </div>
      <div><label for="accountRole" class="block text-sm font-medium text-gray-700 mb-1">Role</label> <select id="accountRole" name="role" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"> <option value="">Pilih Role</option> <option value="Admin">Admin</option> <option value="Operator">Operator</option> <option value="Kepala Sekolah">Kepala Sekolah</option> <option value="Guru">Guru</option> </select>
      </div>
      <div><label for="accountEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label> <input type="email" id="accountEmail" name="email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
      </div>
      <div><label for="accountTelepon" class="block text-sm font-medium text-gray-700 mb-1">No. Telepon</label> <input type="tel" id="accountTelepon" name="telepon" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
      </div>
      <div id="accountFormError" class="hidden text-red-600 text-sm bg-red-50 p-2 rounded-md"></div>
      <div class="flex justify-end space-x-3 pt-4"><button type="button" id="cancelAccountBtn" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors"> Batal </button> <button type="submit" id="saveAccountBtn" class="px-4 py-2 bg-indigo-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-indigo-700 transition-colors"> Simpan </button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Loading Overlay -->
  <div id="loadingOverlay" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
   <div class="bg-white p-6 rounded-lg shadow-lg flex items-center space-x-3">
    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600"></div><span class="text-gray-700">Memproses...</span>
   </div>
  </div>
  <script>
        // Configuration
        const defaultConfig = {
            app_title: "Sistem Pendataan Siswa SD",
            school_name: "SD Islam Tugasku",
            login_title: "Login Administrator",
            background_color: "#fef3c7",
            surface_color: "#ffffff",
            text_color: "#1f2937",
            primary_action_color: "#f59e0b",
            secondary_action_color: "#6b7280"
        };

        // Global variables
        let studentsData = [];
        let activeStudentsData = [];
        let exitStudentsData = [];
        let teachersData = [];
        let staffData = [];
        let accountsData = [];
        let currentEditingStudent = null;
        let currentEditingAccount = null;
        let currentActiveMenu = 'beranda';
        let isLoggedIn = false;

        // Data handler for SDK
        const dataHandler = {
            onDataChanged(data) {
                studentsData = data;
                updateUI();
                updateStats();
            }
        };

        // Initialize SDK and app
        async function initializeApp() {
            if (window.dataSdk) {
                const initResult = await window.dataSdk.init(dataHandler);
                if (!initResult.isOk) {
                    showError("Gagal menginisialisasi sistem penyimpanan data");
                    return;
                }
            }

            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    render,
                    mapToCapabilities,
                    mapToEditPanelValues
                });
            }

            // Initialize default accounts
            initializeDefaultAccounts();
            
            setupEventListeners();
        }

        // Initialize default accounts
        function initializeDefaultAccounts() {
            accountsData = [
                {
                    id: 'acc_admin_001',
                    nama: 'Administrator Sistem',
                    username: 'admin',
                    password: 'admin123',
                    role: 'Admin',
                    email: 'admin@sdnegeri1.sch.id',
                    telepon: '081234567890',
                    status: 'Aktif',
                    last_login: new Date().toISOString(),
                    created_at: new Date().toISOString()
                },
                {
                    id: 'acc_kepsek_001',
                    nama: 'Dra. Siti Nurhaliza, M.Pd',
                    username: 'kepsek',
                    password: 'kepsek123',
                    role: 'Kepala Sekolah',
                    email: 'kepsek@sdnegeri1.sch.id',
                    telepon: '081234567891',
                    status: 'Aktif',
                    last_login: '2024-01-15T10:30:00.000Z',
                    created_at: '2024-01-01T08:00:00.000Z'
                }
            ];
            updateAccountsTable(accountsData);
        }

        // Render function for element SDK
        async function render(config) {
            const appTitle = config.app_title || defaultConfig.app_title;
            const schoolName = config.school_name || defaultConfig.school_name;
            const loginTitle = config.login_title || defaultConfig.login_title;
            const backgroundColor = config.background_color || defaultConfig.background_color;
            const surfaceColor = config.surface_color || defaultConfig.surface_color;
            const textColor = config.text_color || defaultConfig.text_color;
            const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;

            // Update text content
            document.getElementById('appTitle').textContent = appTitle;
            document.getElementById('schoolName').textContent = schoolName;
            document.getElementById('loginTitle').textContent = loginTitle;
            document.title = appTitle;

            // Update colors
            document.body.style.background = `linear-gradient(to bottom right, ${backgroundColor}, ${primaryColor}20)`;
            
            // Update surface colors
            const surfaces = document.querySelectorAll('.bg-white');
            surfaces.forEach(surface => {
                surface.style.backgroundColor = surfaceColor;
            });

            // Update text colors
            const textElements = document.querySelectorAll('.text-gray-900, .text-gray-700, .text-gray-600');
            textElements.forEach(element => {
                element.style.color = textColor;
            });

            // Update primary action colors
            const primaryButtons = document.querySelectorAll('.bg-indigo-600, .bg-blue-500, .bg-green-500, .bg-purple-500');
            primaryButtons.forEach(button => {
                button.style.backgroundColor = primaryColor;
            });

            // Update hover states
            const hoverButtons = document.querySelectorAll('.hover\\:bg-indigo-700');
            hoverButtons.forEach(button => {
                button.addEventListener('mouseenter', () => {
                    button.style.backgroundColor = `${primaryColor}dd`;
                });
                button.addEventListener('mouseleave', () => {
                    button.style.backgroundColor = primaryColor;
                });
            });
        }

        // Capabilities mapping
        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ background_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.surface_color || defaultConfig.surface_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ surface_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.text_color || defaultConfig.text_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ text_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.primary_action_color || defaultConfig.primary_action_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ primary_action_color: value });
                            }
                        }
                    },
                    {
                        get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                        set: (value) => {
                            if (window.elementSdk) {
                                window.elementSdk.setConfig({ secondary_action_color: value });
                            }
                        }
                    }
                ],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        // Edit panel values mapping
        function mapToEditPanelValues(config) {
            return new Map([
                ["app_title", config.app_title || defaultConfig.app_title],
                ["school_name", config.school_name || defaultConfig.school_name],
                ["login_title", config.login_title || defaultConfig.login_title]
            ]);
        }

        // Event listeners setup
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Navigation menu
            document.getElementById('menuBeranda').addEventListener('click', () => switchMenu('beranda'));
            document.getElementById('menuSiswaAktif').addEventListener('click', () => switchMenu('siswaAktif'));
            document.getElementById('menuSiswaKeluar').addEventListener('click', () => switchMenu('siswaKeluar'));
            document.getElementById('menuGuru').addEventListener('click', () => switchMenu('guru'));
            document.getElementById('menuTendik').addEventListener('click', () => switchMenu('tendik'));
            document.getElementById('menuAkun').addEventListener('click', () => switchMenu('akun'));
            
            // Add student button
            document.getElementById('addStudentBtn')?.addEventListener('click', () => openStudentModal());
            document.getElementById('addActiveStudentBtn')?.addEventListener('click', () => openStudentModal('active'));
            document.getElementById('addExitStudentBtn')?.addEventListener('click', () => openStudentModal('exit'));
            document.getElementById('addTeacherBtn')?.addEventListener('click', () => openTeacherModal());
            document.getElementById('addStaffBtn')?.addEventListener('click', () => openStaffModal());
            document.getElementById('addAccountBtn')?.addEventListener('click', () => openAccountModal());
            
            // Modal controls
            document.getElementById('closeModal').addEventListener('click', closeStudentModal);
            document.getElementById('cancelBtn').addEventListener('click', closeStudentModal);
            document.getElementById('closeTeacherModal')?.addEventListener('click', closeTeacherModal);
            document.getElementById('cancelTeacherBtn')?.addEventListener('click', closeTeacherModal);
            document.getElementById('closeStaffModal')?.addEventListener('click', closeStaffModal);
            document.getElementById('cancelStaffBtn')?.addEventListener('click', closeStaffModal);
            document.getElementById('closeAccountModal').addEventListener('click', closeAccountModal);
            document.getElementById('cancelAccountBtn').addEventListener('click', closeAccountModal);
            
            // Student form
            document.getElementById('studentForm').addEventListener('submit', handleStudentSubmit);
            
            // Teacher form
            document.getElementById('teacherForm')?.addEventListener('submit', handleTeacherSubmit);
            
            // Staff form
            document.getElementById('staffForm')?.addEventListener('submit', handleStaffSubmit);
            
            // Account form
            document.getElementById('accountForm').addEventListener('submit', handleAccountSubmit);
            
            // Search functionality
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            document.getElementById('searchActiveInput').addEventListener('input', handleActiveSearch);
            document.getElementById('searchExitInput').addEventListener('input', handleExitSearch);
            document.getElementById('searchTeacherInput').addEventListener('input', handleTeacherSearch);
            document.getElementById('searchStaffInput').addEventListener('input', handleStaffSearch);
            document.getElementById('searchAccountInput').addEventListener('input', handleAccountSearch);
            
            // Modal backdrop click
            document.getElementById('studentModal').addEventListener('click', (e) => {
                if (e.target.id === 'studentModal') {
                    closeStudentModal();
                }
            });
            document.getElementById('accountModal').addEventListener('click', (e) => {
                if (e.target.id === 'accountModal') {
                    closeAccountModal();
                }
            });
        }

        // Login handler
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Simple demo authentication
            if (username === 'admin' && password === 'admin123') {
                isLoggedIn = true;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                document.getElementById('dashboard').classList.add('fade-in');
                hideError('loginError');
            } else {
                showError('Username atau password salah!', 'loginError');
            }
        }

        // Logout handler
        function handleLogout() {
            isLoggedIn = false;
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('loginForm').reset();
            hideError('loginError');
        }

        // Open student modal
        function openStudentModal(type = null, student = null) {
            currentEditingStudent = student;
            const modal = document.getElementById('studentModal');
            const title = document.getElementById('modalTitle');
            const form = document.getElementById('studentForm');
            
            if (student) {
                title.textContent = 'Edit Data Siswa';
                populateForm(student);
            } else {
                if (type === 'active') {
                    title.textContent = 'Tambah Siswa Aktif';
                } else if (type === 'exit') {
                    title.textContent = 'Tambah Data Siswa Keluar';
                } else {
                    title.textContent = 'Tambah Siswa Baru';
                }
                form.reset();
            }
            
            modal.classList.remove('hidden');
            hideError('formError');
        }

        // Close student modal
        function closeStudentModal() {
            document.getElementById('studentModal').classList.add('hidden');
            document.getElementById('studentForm').reset();
            currentEditingStudent = null;
            hideError('formError');
        }

        // Populate form with student data
        function populateForm(student) {
            const fields = ['nama', 'nis', 'kelas', 'jurusan', 'alamat', 'telepon', 'email', 'tanggal_lahir', 'jenis_kelamin'];
            fields.forEach(field => {
                const element = document.getElementById(`student${field.charAt(0).toUpperCase() + field.slice(1).replace('_', '')}`);
                if (element && student[field]) {
                    element.value = student[field];
                }
            });
        }

        // Handle student form submission
        async function handleStudentSubmit(e) {
            e.preventDefault();
            
            if (studentsData.length >= 999 && !currentEditingStudent) {
                showError('Batas maksimum 999 siswa telah tercapai. Silakan hapus beberapa data terlebih dahulu.', 'formError');
                return;
            }

            showLoading();
            
            const formData = new FormData(e.target);
            const studentData = {
                id: currentEditingStudent ? currentEditingStudent.id : generateId(),
                nama: formData.get('nama'),
                nis: formData.get('nis'),
                kelas: formData.get('kelas'),
                jurusan: formData.get('jurusan'),
                alamat: formData.get('alamat'),
                telepon: formData.get('telepon'),
                email: formData.get('email'),
                tanggal_lahir: formData.get('tanggal_lahir'),
                jenis_kelamin: formData.get('jenis_kelamin'),
                created_at: currentEditingStudent ? currentEditingStudent.created_at : new Date().toISOString()
            };

            // Check for duplicate NIS
            const existingStudent = studentsData.find(s => s.nis === studentData.nis && s.id !== studentData.id);
            if (existingStudent) {
                hideLoading();
                showError('NIS sudah digunakan oleh siswa lain!', 'formError');
                return;
            }

            try {
                let result;
                if (currentEditingStudent && window.dataSdk) {
                    result = await window.dataSdk.update({ ...studentData, __backendId: currentEditingStudent.__backendId });
                } else if (window.dataSdk) {
                    result = await window.dataSdk.create(studentData);
                }

                hideLoading();

                if (result && result.isOk) {
                    closeStudentModal();
                    showSuccessMessage(currentEditingStudent ? 'Data siswa berhasil diperbarui!' : 'Siswa baru berhasil ditambahkan!');
                } else if (result && result.isError) {
                    showError('Gagal menyimpan data siswa: ' + result.error.message, 'formError');
                }
            } catch (error) {
                hideLoading();
                showError('Terjadi kesalahan saat menyimpan data', 'formError');
            }
        }

        // Switch menu function
        function switchMenu(menuName) {
            // Update active menu
            currentActiveMenu = menuName;
            
            // Update navigation buttons
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active', 'border-indigo-500', 'text-indigo-600');
                item.classList.add('border-transparent', 'text-gray-500');
            });
            
            const activeButton = document.getElementById(`menu${menuName.charAt(0).toUpperCase() + menuName.slice(1)}`);
            if (activeButton) {
                activeButton.classList.add('active', 'border-indigo-500', 'text-indigo-600');
                activeButton.classList.remove('border-transparent', 'text-gray-500');
            }
            
            // Hide all content sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected content
            const contentMap = {
                'beranda': 'berandaContent',
                'siswaAktif': 'siswaAktifContent',
                'siswaKeluar': 'siswaKeluarContent',
                'guru': 'guruContent',
                'tendik': 'tendikContent',
                'akun': 'akunContent'
            };
            
            const targetContent = document.getElementById(contentMap[menuName]);
            if (targetContent) {
                targetContent.classList.remove('hidden');
                targetContent.classList.add('fade-in');
            }
        }

        // Handle search functions
        function handleSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filteredData = studentsData.filter(student => 
                student.nama.toLowerCase().includes(searchTerm) ||
                student.nis.toLowerCase().includes(searchTerm)
            );
            updateStudentsTable(filteredData);
        }

        function handleActiveSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filteredData = activeStudentsData.filter(student => 
                student.nama.toLowerCase().includes(searchTerm) ||
                student.nis.toLowerCase().includes(searchTerm)
            );
            updateActiveStudentsTable(filteredData);
        }

        function handleExitSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filteredData = exitStudentsData.filter(student => 
                student.nama.toLowerCase().includes(searchTerm) ||
                student.nis.toLowerCase().includes(searchTerm)
            );
            updateExitStudentsTable(filteredData);
        }

        function handleTeacherSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filteredData = teachersData.filter(teacher => 
                teacher.nama.toLowerCase().includes(searchTerm) ||
                teacher.nip.toLowerCase().includes(searchTerm)
            );
            updateTeachersTable(filteredData);
        }

        function handleStaffSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filteredData = staffData.filter(staff => 
                staff.nama.toLowerCase().includes(searchTerm) ||
                staff.nip.toLowerCase().includes(searchTerm)
            );
            updateStaffTable(filteredData);
        }

        function handleAccountSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filteredData = accountsData.filter(account => 
                account.nama.toLowerCase().includes(searchTerm) ||
                account.username.toLowerCase().includes(searchTerm) ||
                account.role.toLowerCase().includes(searchTerm)
            );
            updateAccountsTable(filteredData);
        }

        // Delete student
        async function deleteStudent(student) {
            // Create inline confirmation
            const row = document.querySelector(`[data-student-id="${student.id}"]`);
            const deleteBtn = row.querySelector('.delete-btn');
            const originalText = deleteBtn.innerHTML;
            
            deleteBtn.innerHTML = 'Konfirmasi Hapus?';
            deleteBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
            deleteBtn.classList.add('bg-red-700');
            
            // Add cancel button
            const cancelBtn = document.createElement('button');
            cancelBtn.innerHTML = 'Batal';
            cancelBtn.className = 'ml-2 px-2 py-1 bg-gray-500 hover:bg-gray-600 text-white text-xs rounded transition-colors';
            deleteBtn.parentNode.appendChild(cancelBtn);
            
            const confirmDelete = async () => {
                showLoading();
                try {
                    if (window.dataSdk) {
                        const result = await window.dataSdk.delete(student);
                        hideLoading();
                        
                        if (result.isOk) {
                            showSuccessMessage('Data siswa berhasil dihapus!');
                        } else {
                            showError('Gagal menghapus data siswa');
                        }
                    }
                } catch (error) {
                    hideLoading();
                    showError('Terjadi kesalahan saat menghapus data');
                }
                cleanup();
            };
            
            const cleanup = () => {
                deleteBtn.innerHTML = originalText;
                deleteBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                deleteBtn.classList.remove('bg-red-700');
                if (cancelBtn.parentNode) {
                    cancelBtn.parentNode.removeChild(cancelBtn);
                }
                deleteBtn.removeEventListener('click', confirmDelete);
            };
            
            deleteBtn.addEventListener('click', confirmDelete);
            cancelBtn.addEventListener('click', cleanup);
            
            // Auto cleanup after 5 seconds
            setTimeout(cleanup, 5000);
        }

        // Update UI
        function updateUI() {
            updateStudentsTable(studentsData);
        }

        // Update students table
        function updateStudentsTable(data) {
            const tbody = document.getElementById('studentsTableBody');
            const emptyState = document.getElementById('emptyState');
            
            if (data.length === 0) {
                emptyState.classList.remove('hidden');
                // Remove all student rows
                const studentRows = tbody.querySelectorAll('[data-student-id]');
                studentRows.forEach(row => row.remove());
                return;
            }
            
            emptyState.classList.add('hidden');
            
            // Get existing rows
            const existingRows = new Map();
            tbody.querySelectorAll('[data-student-id]').forEach(row => {
                existingRows.set(row.dataset.studentId, row);
            });
            
            // Update or create rows
            data.forEach(student => {
                if (existingRows.has(student.id)) {
                    updateStudentRow(existingRows.get(student.id), student);
                    existingRows.delete(student.id);
                } else {
                    tbody.appendChild(createStudentRow(student));
                }
            });
            
            // Remove deleted rows
            existingRows.forEach(row => row.remove());
        }

        // Create student row
        function createStudentRow(student) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 transition-colors';
            row.dataset.studentId = student.id;
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="h-10 w-10 flex-shrink-0">
                            <div class="h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center">
                                <span class="text-sm font-medium text-indigo-800">${student.nama.charAt(0).toUpperCase()}</span>
                            </div>
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${student.nama}</div>
                            <div class="text-sm text-gray-500">${student.jenis_kelamin || '-'}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${student.nis}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${student.kelas}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${student.jurusan}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <div>${student.telepon || '-'}</div>
                    <div>${student.email || '-'}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button onclick="openStudentModal(studentsData.find(s => s.id === '${student.id}'))" 
                            class="text-indigo-600 hover:text-indigo-900 mr-3 transition-colors">Edit</button>
                    <button onclick="deleteStudent(studentsData.find(s => s.id === '${student.id}'))" 
                            class="delete-btn bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs transition-colors">Hapus</button>
                </td>
            `;
            
            return row;
        }

        // Update student row
        function updateStudentRow(row, student) {
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="h-10 w-10 flex-shrink-0">
                            <div class="h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center">
                                <span class="text-sm font-medium text-indigo-800">${student.nama.charAt(0).toUpperCase()}</span>
                            </div>
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${student.nama}</div>
                            <div class="text-sm text-gray-500">${student.jenis_kelamin || '-'}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${student.nis}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${student.kelas}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${student.jurusan}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <div>${student.telepon || '-'}</div>
                    <div>${student.email || '-'}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button onclick="openStudentModal(studentsData.find(s => s.id === '${student.id}'))" 
                            class="text-indigo-600 hover:text-indigo-900 mr-3 transition-colors">Edit</button>
                    <button onclick="deleteStudent(studentsData.find(s => s.id === '${student.id}'))" 
                            class="delete-btn bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs transition-colors">Hapus</button>
                </td>
            `;
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalStudents').textContent = studentsData.length;
            document.getElementById('totalTeachers').textContent = teachersData.length;
            document.getElementById('totalStaff').textContent = staffData.length;
        }

        // Delete account
        async function deleteAccount(account) {
            // Prevent deleting the main admin account
            if (account.username === 'admin') {
                showError('Akun admin utama tidak dapat dihapus!');
                return;
            }

            // Create inline confirmation
            const row = document.querySelector(`[data-account-id="${account.id}"]`);
            const deleteBtn = row.querySelector('.delete-account-btn');
            const originalText = deleteBtn.innerHTML;
            
            deleteBtn.innerHTML = 'Konfirmasi Hapus?';
            deleteBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
            deleteBtn.classList.add('bg-red-700');
            
            // Add cancel button
            const cancelBtn = document.createElement('button');
            cancelBtn.innerHTML = 'Batal';
            cancelBtn.className = 'ml-2 px-2 py-1 bg-gray-500 hover:bg-gray-600 text-white text-xs rounded transition-colors';
            deleteBtn.parentNode.appendChild(cancelBtn);
            
            const confirmDelete = async () => {
                showLoading();
                try {
                    // Remove from local data
                    const index = accountsData.findIndex(a => a.id === account.id);
                    if (index !== -1) {
                        accountsData.splice(index, 1);
                        updateAccountsTable(accountsData);
                        showSuccessMessage('Akun berhasil dihapus!');
                    }
                    hideLoading();
                } catch (error) {
                    hideLoading();
                    showError('Terjadi kesalahan saat menghapus akun');
                }
                cleanup();
            };
            
            const cleanup = () => {
                deleteBtn.innerHTML = originalText;
                deleteBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                deleteBtn.classList.remove('bg-red-700');
                if (cancelBtn.parentNode) {
                    cancelBtn.parentNode.removeChild(cancelBtn);
                }
                deleteBtn.removeEventListener('click', confirmDelete);
            };
            
            deleteBtn.addEventListener('click', confirmDelete);
            cancelBtn.addEventListener('click', cleanup);
            
            // Auto cleanup after 5 seconds
            setTimeout(cleanup, 5000);
        }

        // Update accounts table
        function updateAccountsTable(data) {
            const tbody = document.getElementById('accountsTableBody');
            const emptyState = document.getElementById('emptyAccountState');
            
            if (data.length === 0) {
                emptyState.classList.remove('hidden');
                // Remove all account rows
                const accountRows = tbody.querySelectorAll('[data-account-id]');
                accountRows.forEach(row => row.remove());
                return;
            }
            
            emptyState.classList.add('hidden');
            
            // Get existing rows
            const existingRows = new Map();
            tbody.querySelectorAll('[data-account-id]').forEach(row => {
                existingRows.set(row.dataset.accountId, row);
            });
            
            // Update or create rows
            data.forEach(account => {
                if (existingRows.has(account.id)) {
                    updateAccountRow(existingRows.get(account.id), account);
                    existingRows.delete(account.id);
                } else {
                    tbody.appendChild(createAccountRow(account));
                }
            });
            
            // Remove deleted rows
            existingRows.forEach(row => row.remove());
        }

        // Create account row
        function createAccountRow(account) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 transition-colors';
            row.dataset.accountId = account.id;
            
            const statusBadge = account.status === 'Aktif' 
                ? '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Aktif</span>'
                : '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Nonaktif</span>';
            
            const lastLogin = account.last_login 
                ? new Date(account.last_login).toLocaleDateString('id-ID', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                })
                : 'Belum pernah';

            const roleColor = {
                'Admin': 'bg-purple-100 text-purple-800',
                'Kepala Sekolah': 'bg-blue-100 text-blue-800',
                'Operator': 'bg-yellow-100 text-yellow-800',
                'Guru': 'bg-green-100 text-green-800'
            };
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="h-10 w-10 flex-shrink-0">
                            <div class="h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center">
                                <span class="text-sm font-medium text-indigo-800">${account.nama.charAt(0).toUpperCase()}</span>
                            </div>
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${account.nama}</div>
                            <div class="text-sm text-gray-500">${account.email || '-'}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${account.username}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${roleColor[account.role] || 'bg-gray-100 text-gray-800'}">${account.role}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">${statusBadge}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${lastLogin}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button onclick="openAccountModal(accountsData.find(a => a.id === '${account.id}'))" 
                            class="text-indigo-600 hover:text-indigo-900 mr-3 transition-colors">Edit</button>
                    <button onclick="deleteAccount(accountsData.find(a => a.id === '${account.id}'))" 
                            class="delete-account-btn bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs transition-colors ${account.username === 'admin' ? 'opacity-50 cursor-not-allowed' : ''}"
                            ${account.username === 'admin' ? 'disabled' : ''}>Hapus</button>
                </td>
            `;
            
            return row;
        }

        // Update account row
        function updateAccountRow(row, account) {
            const statusBadge = account.status === 'Aktif' 
                ? '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Aktif</span>'
                : '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Nonaktif</span>';
            
            const lastLogin = account.last_login 
                ? new Date(account.last_login).toLocaleDateString('id-ID', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                })
                : 'Belum pernah';

            const roleColor = {
                'Admin': 'bg-purple-100 text-purple-800',
                'Kepala Sekolah': 'bg-blue-100 text-blue-800',
                'Operator': 'bg-yellow-100 text-yellow-800',
                'Guru': 'bg-green-100 text-green-800'
            };
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="h-10 w-10 flex-shrink-0">
                            <div class="h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center">
                                <span class="text-sm font-medium text-indigo-800">${account.nama.charAt(0).toUpperCase()}</span>
                            </div>
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${account.nama}</div>
                            <div class="text-sm text-gray-500">${account.email || '-'}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${account.username}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${roleColor[account.role] || 'bg-gray-100 text-gray-800'}">${account.role}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">${statusBadge}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${lastLogin}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button onclick="openAccountModal(accountsData.find(a => a.id === '${account.id}'))" 
                            class="text-indigo-600 hover:text-indigo-900 mr-3 transition-colors">Edit</button>
                    <button onclick="deleteAccount(accountsData.find(a => a.id === '${account.id}'))" 
                            class="delete-account-btn bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs transition-colors ${account.username === 'admin' ? 'opacity-50 cursor-not-allowed' : ''}"
                            ${account.username === 'admin' ? 'disabled' : ''}>Hapus</button>
                </td>
            `;
        }

        // Utility functions
        function generateId() {
            return 'student_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function generateAccountId() {
            return 'acc_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        function showError(message, elementId = null) {
            if (elementId) {
                const errorElement = document.getElementById(elementId);
                errorElement.textContent = message;
                errorElement.classList.remove('hidden');
            } else {
                // Show toast-like error message
                const toast = document.createElement('div');
                toast.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in';
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => {
                    toast.remove();
                }, 5000);
            }
        }

        function hideError(elementId) {
            const errorElement = document.getElementById(elementId);
            errorElement.classList.add('hidden');
        }

        function showSuccessMessage(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Modal functions for different data types
        function openActiveStudentModal() {
            openStudentModal('active');
        }

        function openExitStudentModal() {
            openStudentModal('exit');
        }

        function openTeacherModal(teacher = null) {
            const modal = document.getElementById('teacherModal');
            const title = document.getElementById('teacherModalTitle');
            const form = document.getElementById('teacherForm');
            
            if (teacher) {
                title.textContent = 'Edit Data Guru';
                populateTeacherForm(teacher);
            } else {
                title.textContent = 'Tambah Data Guru';
                form.reset();
            }
            
            modal.classList.remove('hidden');
            hideError('teacherFormError');
        }

        function closeTeacherModal() {
            document.getElementById('teacherModal').classList.add('hidden');
            document.getElementById('teacherForm').reset();
            hideError('teacherFormError');
        }

        function openStaffModal(staff = null) {
            const modal = document.getElementById('staffModal');
            const title = document.getElementById('staffModalTitle');
            const form = document.getElementById('staffForm');
            
            if (staff) {
                title.textContent = 'Edit Data Staff';
                populateStaffForm(staff);
            } else {
                title.textContent = 'Tambah Data Staff';
                form.reset();
            }
            
            modal.classList.remove('hidden');
            hideError('staffFormError');
        }

        function closeStaffModal() {
            document.getElementById('staffModal').classList.add('hidden');
            document.getElementById('staffForm').reset();
            hideError('staffFormError');
        }

        // Open account modal
        function openAccountModal(account = null) {
            currentEditingAccount = account;
            const modal = document.getElementById('accountModal');
            const title = document.getElementById('accountModalTitle');
            const form = document.getElementById('accountForm');
            const passwordSection = document.getElementById('passwordSection');
            const passwordInput = document.getElementById('accountPassword');
            
            if (account) {
                title.textContent = 'Edit Akun Pengguna';
                populateAccountForm(account);
                // Make password optional for editing
                passwordInput.required = false;
                passwordSection.innerHTML = `
                    <label for="accountPassword" class="block text-sm font-medium text-gray-700 mb-1">Password Baru (kosongkan jika tidak ingin mengubah)</label>
                    <input type="password" id="accountPassword" name="password" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                `;
            } else {
                title.textContent = 'Tambah Akun Baru';
                form.reset();
                passwordInput.required = true;
                passwordSection.innerHTML = `
                    <label for="accountPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="accountPassword" name="password" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                `;
            }
            
            modal.classList.remove('hidden');
            hideError('accountFormError');
        }

        // Close account modal
        function closeAccountModal() {
            document.getElementById('accountModal').classList.add('hidden');
            document.getElementById('accountForm').reset();
            currentEditingAccount = null;
            hideError('accountFormError');
        }

        // Populate account form with data
        function populateAccountForm(account) {
            const fields = ['nama', 'username', 'role', 'email', 'telepon'];
            fields.forEach(field => {
                const element = document.getElementById(`account${field.charAt(0).toUpperCase() + field.slice(1)}`);
                if (element && account[field]) {
                    element.value = account[field];
                }
            });
        }

        // Handle account form submission
        async function handleAccountSubmit(e) {
            e.preventDefault();
            
            if (accountsData.length >= 50 && !currentEditingAccount) {
                showError('Batas maksimum 50 akun telah tercapai. Silakan hapus beberapa akun terlebih dahulu.', 'accountFormError');
                return;
            }

            showLoading();
            
            const formData = new FormData(e.target);
            const accountData = {
                id: currentEditingAccount ? currentEditingAccount.id : generateAccountId(),
                nama: formData.get('nama'),
                username: formData.get('username'),
                role: formData.get('role'),
                email: formData.get('email'),
                telepon: formData.get('telepon'),
                status: 'Aktif',
                last_login: currentEditingAccount ? currentEditingAccount.last_login : null,
                created_at: currentEditingAccount ? currentEditingAccount.created_at : new Date().toISOString()
            };

            // Only update password if provided
            const newPassword = formData.get('password');
            if (newPassword) {
                accountData.password = newPassword;
            } else if (currentEditingAccount) {
                accountData.password = currentEditingAccount.password;
            }

            // Check for duplicate username
            const existingAccount = accountsData.find(a => a.username === accountData.username && a.id !== accountData.id);
            if (existingAccount) {
                hideLoading();
                showError('Username sudah digunakan oleh akun lain!', 'accountFormError');
                return;
            }

            try {
                // Update local data
                if (currentEditingAccount) {
                    const index = accountsData.findIndex(a => a.id === currentEditingAccount.id);
                    if (index !== -1) {
                        accountsData[index] = accountData;
                    }
                } else {
                    accountsData.push(accountData);
                }

                updateAccountsTable(accountsData);
                hideLoading();
                closeAccountModal();
                showSuccessMessage(currentEditingAccount ? 'Akun berhasil diperbarui!' : 'Akun baru berhasil ditambahkan!');
            } catch (error) {
                hideLoading();
                showError('Terjadi kesalahan saat menyimpan data akun', 'accountFormError');
            }
        }

        // Update table functions for different data types
        function updateActiveStudentsTable(data) {
            const tbody = document.getElementById('activeStudentsTableBody');
            const emptyState = document.getElementById('emptyActiveState');
            
            if (data.length === 0) {
                emptyState.classList.remove('hidden');
                const studentRows = tbody.querySelectorAll('[data-active-student-id]');
                studentRows.forEach(row => row.remove());
                return;
            }
            
            emptyState.classList.add('hidden');
            // Implementation for active students table would go here
        }

        function updateExitStudentsTable(data) {
            const tbody = document.getElementById('exitStudentsTableBody');
            const emptyState = document.getElementById('emptyExitState');
            
            if (data.length === 0) {
                emptyState.classList.remove('hidden');
                const studentRows = tbody.querySelectorAll('[data-exit-student-id]');
                studentRows.forEach(row => row.remove());
                return;
            }
            
            emptyState.classList.add('hidden');
            // Implementation for exit students table would go here
        }

        function updateTeachersTable(data) {
            const tbody = document.getElementById('teachersTableBody');
            const emptyState = document.getElementById('emptyTeacherState');
            
            if (data.length === 0) {
                emptyState.classList.remove('hidden');
                const teacherRows = tbody.querySelectorAll('[data-teacher-id]');
                teacherRows.forEach(row => row.remove());
                return;
            }
            
            emptyState.classList.add('hidden');
            
            // Get existing rows
            const existingRows = new Map();
            tbody.querySelectorAll('[data-teacher-id]').forEach(row => {
                existingRows.set(row.dataset.teacherId, row);
            });
            
            // Update or create rows
            data.forEach(teacher => {
                if (existingRows.has(teacher.id)) {
                    updateTeacherRow(existingRows.get(teacher.id), teacher);
                    existingRows.delete(teacher.id);
                } else {
                    tbody.appendChild(createTeacherRow(teacher));
                }
            });
            
            // Remove deleted rows
            existingRows.forEach(row => row.remove());
        }

        // Create teacher row
        function createTeacherRow(teacher) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 transition-colors';
            row.dataset.teacherId = teacher.id;
            
            const statusBadge = teacher.status === 'PNS' 
                ? '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">PNS</span>'
                : teacher.status === 'Honorer'
                ? '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Honorer</span>'
                : '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">Kontrak</span>';
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="h-10 w-10 flex-shrink-0">
                            <div class="h-10 w-10 rounded-full bg-green-100 flex items-center justify-center">
                                <span class="text-sm font-medium text-green-800">${teacher.nama.charAt(0).toUpperCase()}</span>
                            </div>
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${teacher.nama}</div>
                            <div class="text-sm text-gray-500">${teacher.email || '-'}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${teacher.nip}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${teacher.mata_pelajaran}</td>
                <td class="px-6 py-4 whitespace-nowrap">${statusBadge}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button onclick="openTeacherModal(teachersData.find(t => t.id === '${teacher.id}'))" 
                            class="text-indigo-600 hover:text-indigo-900 mr-3 transition-colors">Edit</button>
                    <button onclick="deleteTeacher(teachersData.find(t => t.id === '${teacher.id}'))" 
                            class="delete-teacher-btn bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs transition-colors">Hapus</button>
                </td>
            `;
            
            return row;
        }

        // Update teacher row
        function updateTeacherRow(row, teacher) {
            const statusBadge = teacher.status === 'PNS' 
                ? '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">PNS</span>'
                : teacher.status === 'Honorer'
                ? '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Honorer</span>'
                : '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">Kontrak</span>';
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="h-10 w-10 flex-shrink-0">
                            <div class="h-10 w-10 rounded-full bg-green-100 flex items-center justify-center">
                                <span class="text-sm font-medium text-green-800">${teacher.nama.charAt(0).toUpperCase()}</span>
                            </div>
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${teacher.nama}</div>
                            <div class="text-sm text-gray-500">${teacher.email || '-'}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${teacher.nip}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${teacher.mata_pelajaran}</td>
                <td class="px-6 py-4 whitespace-nowrap">${statusBadge}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button onclick="openTeacherModal(teachersData.find(t => t.id === '${teacher.id}'))" 
                            class="text-indigo-600 hover:text-indigo-900 mr-3 transition-colors">Edit</button>
                    <button onclick="deleteTeacher(teachersData.find(t => t.id === '${teacher.id}'))" 
                            class="delete-teacher-btn bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs transition-colors">Hapus</button>
                </td>
            `;
        }

        // Delete teacher
        async function deleteTeacher(teacher) {
            const row = document.querySelector(`[data-teacher-id="${teacher.id}"]`);
            const deleteBtn = row.querySelector('.delete-teacher-btn');
            const originalText = deleteBtn.innerHTML;
            
            deleteBtn.innerHTML = 'Konfirmasi Hapus?';
            deleteBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
            deleteBtn.classList.add('bg-red-700');
            
            const cancelBtn = document.createElement('button');
            cancelBtn.innerHTML = 'Batal';
            cancelBtn.className = 'ml-2 px-2 py-1 bg-gray-500 hover:bg-gray-600 text-white text-xs rounded transition-colors';
            deleteBtn.parentNode.appendChild(cancelBtn);
            
            const confirmDelete = async () => {
                showLoading();
                try {
                    const index = teachersData.findIndex(t => t.id === teacher.id);
                    if (index !== -1) {
                        teachersData.splice(index, 1);
                        updateTeachersTable(teachersData);
                        updateStats();
                        showSuccessMessage('Data guru berhasil dihapus!');
                    }
                    hideLoading();
                } catch (error) {
                    hideLoading();
                    showError('Terjadi kesalahan saat menghapus data guru');
                }
                cleanup();
            };
            
            const cleanup = () => {
                deleteBtn.innerHTML = originalText;
                deleteBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                deleteBtn.classList.remove('bg-red-700');
                if (cancelBtn.parentNode) {
                    cancelBtn.parentNode.removeChild(cancelBtn);
                }
                deleteBtn.removeEventListener('click', confirmDelete);
            };
            
            deleteBtn.addEventListener('click', confirmDelete);
            cancelBtn.addEventListener('click', cleanup);
            
            setTimeout(cleanup, 5000);
        }

        function updateStaffTable(data) {
            const tbody = document.getElementById('staffTableBody');
            const emptyState = document.getElementById('emptyStaffState');
            
            if (data.length === 0) {
                emptyState.classList.remove('hidden');
                const staffRows = tbody.querySelectorAll('[data-staff-id]');
                staffRows.forEach(row => row.remove());
                return;
            }
            
            emptyState.classList.add('hidden');
            
            // Get existing rows
            const existingRows = new Map();
            tbody.querySelectorAll('[data-staff-id]').forEach(row => {
                existingRows.set(row.dataset.staffId, row);
            });
            
            // Update or create rows
            data.forEach(staff => {
                if (existingRows.has(staff.id)) {
                    updateStaffRow(existingRows.get(staff.id), staff);
                    existingRows.delete(staff.id);
                } else {
                    tbody.appendChild(createStaffRow(staff));
                }
            });
            
            // Remove deleted rows
            existingRows.forEach(row => row.remove());
        }

        // Create staff row
        function createStaffRow(staff) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 transition-colors';
            row.dataset.staffId = staff.id;
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="h-10 w-10 flex-shrink-0">
                            <div class="h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center">
                                <span class="text-sm font-medium text-purple-800">${staff.nama.charAt(0).toUpperCase()}</span>
                            </div>
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${staff.nama}</div>
                            <div class="text-sm text-gray-500">${staff.email || '-'}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${staff.nip}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${staff.jabatan}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${staff.unit_kerja}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button onclick="openStaffModal(staffData.find(s => s.id === '${staff.id}'))" 
                            class="text-indigo-600 hover:text-indigo-900 mr-3 transition-colors">Edit</button>
                    <button onclick="deleteStaff(staffData.find(s => s.id === '${staff.id}'))" 
                            class="delete-staff-btn bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs transition-colors">Hapus</button>
                </td>
            `;
            
            return row;
        }

        // Update staff row
        function updateStaffRow(row, staff) {
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="h-10 w-10 flex-shrink-0">
                            <div class="h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center">
                                <span class="text-sm font-medium text-purple-800">${staff.nama.charAt(0).toUpperCase()}</span>
                            </div>
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${staff.nama}</div>
                            <div class="text-sm text-gray-500">${staff.email || '-'}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${staff.nip}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${staff.jabatan}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${staff.unit_kerja}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button onclick="openStaffModal(staffData.find(s => s.id === '${staff.id}'))" 
                            class="text-indigo-600 hover:text-indigo-900 mr-3 transition-colors">Edit</button>
                    <button onclick="deleteStaff(staffData.find(s => s.id === '${staff.id}'))" 
                            class="delete-staff-btn bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs transition-colors">Hapus</button>
                </td>
            `;
        }

        // Delete staff
        async function deleteStaff(staff) {
            const row = document.querySelector(`[data-staff-id="${staff.id}"]`);
            const deleteBtn = row.querySelector('.delete-staff-btn');
            const originalText = deleteBtn.innerHTML;
            
            deleteBtn.innerHTML = 'Konfirmasi Hapus?';
            deleteBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
            deleteBtn.classList.add('bg-red-700');
            
            const cancelBtn = document.createElement('button');
            cancelBtn.innerHTML = 'Batal';
            cancelBtn.className = 'ml-2 px-2 py-1 bg-gray-500 hover:bg-gray-600 text-white text-xs rounded transition-colors';
            deleteBtn.parentNode.appendChild(cancelBtn);
            
            const confirmDelete = async () => {
                showLoading();
                try {
                    const index = staffData.findIndex(s => s.id === staff.id);
                    if (index !== -1) {
                        staffData.splice(index, 1);
                        updateStaffTable(staffData);
                        updateStats();
                        showSuccessMessage('Data staff berhasil dihapus!');
                    }
                    hideLoading();
                } catch (error) {
                    hideLoading();
                    showError('Terjadi kesalahan saat menghapus data staff');
                }
                cleanup();
            };
            
            const cleanup = () => {
                deleteBtn.innerHTML = originalText;
                deleteBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                deleteBtn.classList.remove('bg-red-700');
                if (cancelBtn.parentNode) {
                    cancelBtn.parentNode.removeChild(cancelBtn);
                }
                deleteBtn.removeEventListener('click', confirmDelete);
            };
            
            deleteBtn.addEventListener('click', confirmDelete);
            cancelBtn.addEventListener('click', cleanup);
            
            setTimeout(cleanup, 5000);
        }

        // Populate teacher form
        function populateTeacherForm(teacher) {
            const fields = ['nama', 'nip', 'mata_pelajaran', 'status', 'telepon', 'email', 'alamat'];
            fields.forEach(field => {
                const element = document.getElementById(`teacher${field.charAt(0).toUpperCase() + field.slice(1).replace('_', '')}`);
                if (element && teacher[field]) {
                    element.value = teacher[field];
                }
            });
        }

        // Populate staff form
        function populateStaffForm(staff) {
            const fields = ['nama', 'nip', 'jabatan', 'unit_kerja', 'telepon', 'email', 'alamat'];
            fields.forEach(field => {
                const element = document.getElementById(`staff${field.charAt(0).toUpperCase() + field.slice(1).replace('_', '')}`);
                if (element && staff[field]) {
                    element.value = staff[field];
                }
            });
        }

        // Handle teacher form submission
        async function handleTeacherSubmit(e) {
            e.preventDefault();
            
            if (teachersData.length >= 100) {
                showError('Batas maksimum 100 guru telah tercapai. Silakan hapus beberapa data terlebih dahulu.', 'teacherFormError');
                return;
            }

            showLoading();
            
            const formData = new FormData(e.target);
            const teacherData = {
                id: generateId(),
                nama: formData.get('nama'),
                nip: formData.get('nip'),
                mata_pelajaran: formData.get('mata_pelajaran'),
                status: formData.get('status'),
                telepon: formData.get('telepon'),
                email: formData.get('email'),
                alamat: formData.get('alamat'),
                created_at: new Date().toISOString()
            };

            // Check for duplicate NIP
            const existingTeacher = teachersData.find(t => t.nip === teacherData.nip);
            if (existingTeacher) {
                hideLoading();
                showError('NIP sudah digunakan oleh guru lain!', 'teacherFormError');
                return;
            }

            try {
                teachersData.push(teacherData);
                updateTeachersTable(teachersData);
                updateStats();
                hideLoading();
                closeTeacherModal();
                showSuccessMessage('Data guru berhasil ditambahkan!');
            } catch (error) {
                hideLoading();
                showError('Terjadi kesalahan saat menyimpan data guru', 'teacherFormError');
            }
        }

        // Handle staff form submission
        async function handleStaffSubmit(e) {
            e.preventDefault();
            
            if (staffData.length >= 100) {
                showError('Batas maksimum 100 staff telah tercapai. Silakan hapus beberapa data terlebih dahulu.', 'staffFormError');
                return;
            }

            showLoading();
            
            const formData = new FormData(e.target);
            const staffDataItem = {
                id: generateId(),
                nama: formData.get('nama'),
                nip: formData.get('nip'),
                jabatan: formData.get('jabatan'),
                unit_kerja: formData.get('unit_kerja'),
                telepon: formData.get('telepon'),
                email: formData.get('email'),
                alamat: formData.get('alamat'),
                created_at: new Date().toISOString()
            };

            // Check for duplicate NIP
            const existingStaff = staffData.find(s => s.nip === staffDataItem.nip);
            if (existingStaff) {
                hideLoading();
                showError('NIP sudah digunakan oleh staff lain!', 'staffFormError');
                return;
            }

            try {
                staffData.push(staffDataItem);
                updateStaffTable(staffData);
                updateStats();
                hideLoading();
                closeStaffModal();
                showSuccessMessage('Data staff berhasil ditambahkan!');
            } catch (error) {
                hideLoading();
                showError('Terjadi kesalahan saat menyimpan data staff', 'staffFormError');
            }
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'992e457273b5b5ac',t:'MTc2MTE5MTQzNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>